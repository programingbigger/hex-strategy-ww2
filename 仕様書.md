## **【更新版】ゲーム仕様書：Gemini Saga - Hex Strategy**

### 1. **ゲーム概要**

このアプリケーションは、第二次世界大戦をテーマにした、ヘックス（六角形）グリッド上で進行するターン制の戦略シミュレーションゲームです。プレイヤーは「Blue」チームまたは「Red」チームを率いて、敵チームの全ユニットを殲滅することを目指します。

最大の特徴は、戦闘結果をGoogleのGemini AIを用いて物語風に生成する「戦闘レポート」機能です。

* **プラットフォーム**: Webブラウザ
* **開発言語**: TypeScript
* **UIライブラリ**: React
* **ビルドツール**: Vite

---

### 2. **ユニット特性**

ゲームには4種類のユニットが登場し、それぞれ異なるステータス（能力値）と特性を持ちます。

| ユニット種別 | 最大HP | 攻撃力 | 防御力 | 移動力 | 攻撃範囲 | 反撃 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **Infantry (歩兵)** | 10 | 4 | 2 | 3 | 1 | 可能 |
| **Tank (戦車)** | 20 | 7 | 5 | 4 | 1 | 可能 |
| **ArmoredCar (装甲車)** | 15 | 5 | 4 | 6 | 1 | 可能 |
| **Artillery (砲兵)** | 12 | 8 | 3 | 1 | 2-5 | 不可 |

* **攻撃範囲**: ユニットが攻撃できる距離（ヘックス数）。砲兵は隣接する敵を攻撃できず、2〜5マス離れた敵を攻撃します。
* **反撃**: 攻撃された際に反撃できるかどうか。砲兵は反撃できません。

---

### 3. **地形特性**

マップは複数の地形で構成されており、それぞれがユニットの戦闘や移動に影響を与えます。

| 地形種別 | 防御ボーナス | 攻撃ボーナス | 移動コスト |
| :--- | :--- | :--- | :--- |
| **Plains (平原)** | 0 | 0 | 全ユニット: 1 |
| **Forest (森林)** | +2 | 0 | 歩兵/砲兵: 1, 戦車/装甲車: 2 |
| **Mountain (山岳)**| +3 | +2 | 歩兵: 2, その他: 移動不可 |
| **River (川)** | -2 | -1 | 歩兵: 2, その他: 移動不可 |
| **Road (道路)** | -1 | 0 | 全ユニット: 1 |
| **Bridge (橋)** | -1 | 0 | 全ユニット: 1 |
| **City (都市)** | +3 | +1 | 全ユニット: 1 |
| **Mud (泥沼)** | -1 | 0 | 歩兵: 2, 戦車: 3, 装甲車: 4, 砲兵: 1 |

* **防御ボーナス**: その地形にいるユニットの防御力に加算されます。
* **攻撃ボーナス**: その地形にいるユニットの攻撃力に加算されます。
* **移動コスト**: その地形を1マス移動するために必要な移動力。コストがユニットの移動力を超える場合や「移動不可」の場合は、その地形に進入できません。

---

### 4. **プログラム仕様 (ファイル別機能一覧)**

このプログラムはコンポーネントベースで設計されており、各ファイルが特定の役割を担っています。

| ファイルパス | 主な役割と情報 |
| :--- | :--- |
| **`App.tsx`** | 🧠 **アプリケーションの心臓部**。ゲーム全体のロジックと状態（ターン、アクティブチーム、ユニット、ゲーム状態など）を管理します。ユニットの選択、移動、攻撃などの主要なゲームイベントのハンドリングを行います。 |
| **`constants.ts`** | 🔢 **ゲーム内定数**。ユニットのステータス、地形の効果、ユニットの初期配置など、ゲームの根幹をなす不変のデータが定義されています。 |
| **`types.ts`** | 📝 **TypeScriptの型定義**。`Unit`（ユニット）、`Tile`（タイル）、`Team`（チーム）など、アプリケーション全体で使用されるデータ構造を定義し、コードの安全性を保証します。 |
| **`utils/map.ts`** | 🗺️📐 **マップ関連の計算処理**。ランダムなマップレイアウトの生成、ユニットの移動可能範囲の計算（ダイクストラ法に似たアルゴリズム）、座標計算などの関数が含まれます。 |
| **`services/battleReport.ts`** | 🤖 **戦闘レポート生成**。戦闘情報を基に、物語風のテキストを生成するサービスです。Gemini APIとの連携を担う部分です。 |
| **`components/GameBoard.tsx`** | 🗺️ **ゲーム盤の描画**。ヘックスタイル、ユニット、移動可能範囲、攻撃可能範囲などをSVGで描画するメインコンポーネントです。 |
| **`components/InfoPanel.tsx`** | ℹ️ **情報パネル**。選択したユニットやマウスオーバーしたタイルの詳細情報を表示します。ゲームオーバー時の結果表示やリスタート機能も提供します。 |
| **`components/Header.tsx`** | 🔝 **ヘッダー**。現在のターン数、アクティブなチーム、各チームの残りユニット数を表示し、「ターン終了」ボタンを提供します。 |
| **`components/BattleReportModal.tsx`** | 💥 **戦闘レポートモーダル**。戦闘結果をドラマチックに表示するためのUIコンポーネントです。 |
| **`components/Hexagon.tsx`** | ⬢ **ヘックスタイル**。個々の六角形タイルを描画し、地形に応じた色や移動可能範囲のハイライトを表現します。 |
| **`components/Icons.tsx`** | 🛡️ **ユニットアイコン**。ユニットの種類（歩兵、戦車など）を視覚的に表現するSVGアイコンを描画します。 |
| **`index.html` & `index.tsx`** | 🚀 **起動ファイル**。アプリケーションのエントリーポイント（起動点）です。HTMLの骨格を定義し、ReactアプリケーションをDOMに描画します。 |
| **`README.md`** | 📖 **説明書**。プロジェクトの概要と、ローカル環境でアプリケーションを実行するための手順が記載されています。 |