# ヘキサゴナルマップパターン生成ガイド

## 概要

本ドキュメントは、base_map.jsonで使用されているヘキサゴナル格子上の矩形マップパターンを言語化し、AI生成時のテンプレートとして活用するためのガイドです。

## base_map.jsonの構造分析

### 基本仕様
- **座標系**: ヘキサゴナル軸座標システム (x, y)
- **構成**: 5行 × 最大10列 (48タイル)
- **形状**: 視覚的に矩形境界を形成
- **地形**: 全タイル統一（Plains）

### 実際の座標パターン
```
Y=-2(偶数行): X=-4~5   (10タイル) - 最上段
Y=-1(奇数行): X=-4~4   (9タイル)  - 右端が1つ短い
Y=0(偶数行):  X=-5~4   (10タイル) - 左端が1つ拡張
Y=1(奇数行):  X=-5~3   (9タイル)  - 右端が1つ短い
Y=2(偶数行):  X=-6~3   (10タイル) - 最下段、左端が最も拡張
```

## 一般化パターン仕様

### 基本原則
**偶数行nタイル、奇数行(n-1)タイル**の規則に従い矩形境界を形成

### パラメータ定義
- `n` = 偶数行のタイル数
- 偶数行（Y % 2 == 0）: nタイル配置
- 奇数行（Y % 2 != 0）: (n-1)タイル配置

### 座標生成アルゴリズム

5行構成（Y = -2, -1, 0, 1, 2）の場合：

```
Y=-2 (最上段・偶数行): X = -4 ~ (n-5)     → nタイル
Y=-1 (上段・奇数行):   X = -4 ~ (n-6)     → (n-1)タイル  
Y=0  (中央・偶数行):   X = -5 ~ (n-6)     → nタイル
Y=1  (下段・奇数行):   X = -5 ~ (n-7)     → (n-1)タイル
Y=2  (最下段・偶数行): X = -6 ~ (n-7)     → nタイル
```

### 境界形成メカニズム

1. **水平境界**: 偶数行と奇数行のタイル数差により直線的な左右境界を形成
2. **垂直境界**: 各行の左端が段階的にシフト（-4→-5→-6）し、対応する右端調整
3. **矩形効果**: ヘキサゴナル格子特性を活かした視覚的四角形境界の実現

## スケーラビリティ例

| n値 | 偶数行タイル数 | 奇数行タイル数 | 総タイル数 | 視覚的サイズ |
|-----|-------------|-------------|-----------|-------------|
| 6   | 6           | 5           | 28        | 小          |
| 8   | 8           | 7           | 38        | 中          |
| 10  | 10          | 9           | 48        | 大（base）   |
| 12  | 12          | 11          | 58        | 特大        |

### 各スケール例

#### n=6の場合
```
Y=-2: X=-4~1  (6タイル)
Y=-1: X=-4~0  (5タイル)
Y=0:  X=-5~0  (6タイル)
Y=1:  X=-5~-1 (5タイル)
Y=2:  X=-6~-1 (6タイル)
```

#### n=12の場合
```
Y=-2: X=-4~7  (12タイル)
Y=-1: X=-4~6  (11タイル)
Y=0:  X=-5~6  (12タイル)
Y=1:  X=-5~5  (11タイル)
Y=2:  X=-6~5  (12タイル)
```

## AI生成用テンプレート

### 生成パラメータ指定
```json
{
  "grid_type": "hexagonal_rectangular",
  "pattern_rule": "even_row_n_tiles_odd_row_n_minus_1",
  "base_parameter_n": [希望する偶数行タイル数],
  "total_rows": 5,
  "coordinate_system": "axial_xy",
  "center_coordinate": {"x": 0, "y": 0}
}
```

### 生成手順
1. **パラメータn決定**: 希望するマップサイズに応じて設定
2. **行別座標計算**: 上記アルゴリズムに従い各行の座標範囲を算出
3. **タイル配置**: 欠損なく連続的にタイルを配置
4. **地形割り当て**: 各タイルに適切な地形タイプを設定
5. **JSON生成**: base_map.json互換フォーマットで出力

### AI生成プロンプト例

```
以下の仕様でヘキサゴナルマップを生成してください：

- 形状：矩形境界（base_map.jsonパターン）
- サイズ：偶数行8タイル、奇数行7タイル
- 地形：Plains 70%, Forest 20%, Mountain 10%の割合で配置
- 座標系：ヘキサゴナル軸座標(x,y)
- 行構成：5行（Y=-2から2）
- 境界形成：各行左端の段階的シフトによる矩形効果

出力形式：base_map.json互換のJSONフォーマット
```

## 開発者向け実装ガイド

### マップ生成関数の実装例

```javascript
function generateHexagonalRectangleMap(n, terrainTypes = ['Plains']) {
  const tiles = [];
  const yRange = [-2, -1, 0, 1, 2];
  
  yRange.forEach(y => {
    let xMin, xMax;
    
    // 座標範囲計算
    if (y === -2) { xMin = -4; xMax = n - 5; }
    else if (y === -1) { xMin = -4; xMax = n - 6; }
    else if (y === 0) { xMin = -5; xMax = n - 6; }
    else if (y === 1) { xMin = -5; xMax = n - 7; }
    else if (y === 2) { xMin = -6; xMax = n - 7; }
    
    // タイル生成
    for (let x = xMin; x <= xMax; x++) {
      tiles.push({
        x: x,
        y: y,
        terrain: getRandomTerrain(terrainTypes)
      });
    }
  });
  
  return tiles;
}
```

### 検証方法

生成されたマップが正しいパターンに従っているかを確認：

1. **タイル数検証**: 偶数行がn個、奇数行が(n-1)個のタイルを持つ
2. **境界連続性**: 隣接するタイル間に欠損がない
3. **矩形形状**: 視覚的に四角形境界を形成している
4. **座標整合性**: 指定した座標範囲内にすべてのタイルが配置されている

## 応用例

### 異なるサイズのマップ生成
- **小規模戦闘**: n=6 (28タイル)
- **中規模戦闘**: n=8 (38タイル)  
- **大規模戦闘**: n=12 (58タイル)

### 地形バリエーション
- **平原マップ**: Plains 100%
- **森林マップ**: Forest 60%, Plains 40%
- **山岳マップ**: Mountain 40%, Plains 40%, Forest 20%
- **混合マップ**: 各地形をランダム配置

---

*このドキュメントは、base_map.jsonの矩形パターンを基に、効率的なマップ生成を支援するために作成されました。*