# useGameLogic - メインゲームロジックフック

## 概要
ヘックス戦略ゲームの核となるロジックを管理するReactカスタムフックです。ゲーム状態、戦闘システム、ターン管理、勝利条件などすべてのゲームメカニクスを統合管理します。

## ファイル場所
`/Commander/src/hooks/useGameLogic.ts`

## 主要機能

### 状態管理
- **ゲーム状態**: 現在のゲームフェーズとプレイヤーターンの管理
- **ボード管理**: ヘックスマップの状態とユニット配置の追跡
- **ユニット管理**: 全ユニットの位置、HP、状態の一元管理

### 戦闘システム
- **攻撃計算**: 地形効果を含む総合的なダメージ計算
- **反撃システム**: 攻撃を受けた際の自動反撃処理
- **経験値システム**: 戦闘により得られる経験値とレベルアップ

### ターン管理
- **フェーズ移行**: プレイヤーターン → 敵ターン → ターン終了の流れ
- **ユニット回復**: ターン開始時の自動HP回復処理
- **天候システム**: ランダムな天候変化とゲームへの影響

## 主要な関数とメソッド

### 戦闘関連
```typescript
// 攻撃実行
const executeAttack = (attacker: Unit, defender: Unit) => {
  // 1. 地形ボーナス計算
  // 2. ダメージ計算
  // 3. 反撃処理
  // 4. 経験値付与
}

// 移動可能範囲計算
const calculateReachableTiles = (unit: Unit) => {
  // 1. ユニットの移動力取得
  // 2. 地形による移動コスト計算
  // 3. 到達可能タイルのリスト生成
}
```

### 都市システム
```typescript
// 都市占領処理
const captureCity = (unit: Unit, city: City) => {
  // 1. 歩兵ユニットかチェック
  // 2. 所有権変更
  // 3. 収入計算更新
}
```

### AI思考ルーチン
```typescript
// 敵AIのターン処理
const processEnemyTurn = () => {
  // 1. 全敵ユニットの行動優先度計算
  // 2. 最適な行動選択
  // 3. 移動・攻撃の実行
}
```

## ゲームへの影響とポイント

### 戦闘バランス
- **ダメージ計算式**: `基本攻撃力 + 地形ボーナス - 敵防御力`
- **命中率システム**: 距離と地形による命中率修正
- **クリティカルヒット**: 低確率での追加ダメージ

### 戦略的要素
- **燃料システム**: 移動に燃料を消費、補給の重要性
- **地形活用**: 森林・山地での防御ボーナス活用
- **都市経済**: 都市占領による収入増加と戦略的価値

### ゲームテンポ
- **ターン制限**: 長期戦を防ぐターン数上限
- **勝利条件**: 敵全滅 or 主要都市占領 or ターン経過
- **自動回復**: 戦闘継続性を保つHP回復システム

## 設定可能パラメータ

### 戦闘バランス
```typescript
const COMBAT_SETTINGS = {
  BASE_HIT_RATE: 85,        // 基本命中率
  CRITICAL_RATE: 10,        // クリティカル率
  COUNTER_ATTACK_RATE: 80,  // 反撃率
  EXPERIENCE_GAIN: 1,       // 経験値獲得量
}
```

### ゲームバランス
```typescript
const GAME_SETTINGS = {
  MAX_TURNS: 30,           // 最大ターン数
  HEALING_PER_TURN: 2,     // ターン回復量
  FUEL_CONSUMPTION: 1,     // 移動時燃料消費
  WEATHER_CHANGE_RATE: 20, // 天候変化確率
}
```

## 依存関係
- [[types-index]] - 全ての型定義に依存
- [[constants]] - ゲーム定数とユニット能力値に依存
- React Hook システム - useState, useEffect, useCallback

## パフォーマンス最適化

### メモ化
- **useCallback**: 重い計算処理の結果をキャッシュ
- **useMemo**: 移動範囲計算などの最適化
- **状態分割**: 必要な部分のみの再計算

### 計算効率化
- **パスファインディング**: A*アルゴリズムによる最適経路探索
- **AI思考**: 評価関数による効率的な行動選択
- **衝突検出**: 空間分割による高速な位置検索

## エラーハンドリング
- **不正な移動**: 範囲外移動の防止
- **無効な攻撃**: 攻撃範囲外ターゲットの制限
- **状態不整合**: ゲーム状態の整合性チェック

## デバッグ機能
- **ログ出力**: 戦闘結果と計算過程の詳細ログ
- **状態ダンプ**: 任意時点でのゲーム状態保存
- **リプレイ機能**: ターン単位での巻き戻し（開発用）

## 関連ファイル
- [[constants]] - ゲームバランス設定値
- [[types-index]] - 使用する全型定義
- [[GameBoard]] - UI側でのゲーム状態表示
- [[BattleScreen]] - メイン戦闘画面での使用

## タグ
#useGameLogic #GameCore #Hooks #Combat #TurnManagement #AI #Strategy