# BattleScreen - 戦闘画面

## 概要
ヘックス戦略ゲームのメイン戦闘画面です。ゲームボード、情報パネル、ヘッダーを統合し、プレイヤーが実際にゲームをプレイする中核画面として機能します。

## ファイル場所
`/Commander/src/screens/BattleScreen.tsx`

## 主要機能

### 画面構成
- **ヘッダー部**: ターン情報、天候、勝利条件の表示
- **メインエリア**: ゲームボードとユニット配置
- **サイドパネル**: 選択ユニット/タイルの詳細情報
- **アクションバー**: 可能な行動の選択UI

### ゲーム操作
- **ユニット選択**: ボード上のユニットクリックで選択
- **移動指示**: 移動可能範囲内のタイルクリックで移動実行  
- **攻撃指示**: 攻撃可能な敵ユニットクリックで攻撃実行
- **ターン終了**: プレイヤーターンの手動終了

### 状態表示
- **ターン表示**: 現在のターン数とプレイヤー
- **天候表示**: 現在の天候とその効果
- **勝利条件**: 残り必要条件の表示

## Props（引数）

```typescript
interface BattleScreenProps {
  gameData: GameData;           // ゲーム初期データ
  onGameEnd: (result: GameResult) => void;  // ゲーム終了時の処理
  onPause: () => void;          // ポーズ機能
  onSave: (saveData: SaveData) => void;     // セーブ機能
}
```

## 画面レイアウト

```
┌─────────────────────────────────────────┐
│ Header: Turn 5 | Weather: Rain | Blue   │
├─────────────────────┬───────────────────┤
│                     │ Information Panel │
│    Game Board       │ ┌─────────────────┤
│   (Hex Grid)        │ │ Selected Unit   │
│                     │ │ HP: 8/10        │
│                     │ │ Attack: 4       │
│                     │ │ Defense: 2      │
│                     │ │                 │
│                     │ │ Actions:        │
│                     │ │ [Move][Attack]  │
├─────────────────────┴───────────────────┤
│ Action Bar: [End Turn] [Menu] [Save]    │
└─────────────────────────────────────────┘
```

## ゲームフロー制御

### ターン管理
```typescript
const handleTurnEnd = () => {
  // 1. プレイヤーターン終了処理
  // 2. 敵AIターン実行
  // 3. ターン終了時処理（回復、天候変化等）
  // 4. 勝利条件チェック
  // 5. 次ターン開始
}
```

### 勝利判定
```typescript
const checkVictoryConditions = () => {
  // 1. 敵全滅チェック
  // 2. 主要都市占領チェック  
  // 3. ターン制限チェック
  // 4. 勝利/敗北/引き分け判定
}
```

## ユーザーインタラクション

### 操作シーケンス
1. **ユニット選択**: 自軍ユニットをクリック
2. **行動選択**: 移動 or 攻撃の選択
3. **対象選択**: 移動先 or 攻撃対象の指定
4. **実行確認**: アクションの確定
5. **結果表示**: 戦闘結果やダメージの表示

### キーボードショートカット
- **スペース**: ターン終了
- **Esc**: 選択解除
- **Tab**: 次のユニット選択
- **Ctrl+S**: ゲーム保存

## ゲームへの影響とポイント

### 戦術的思考の促進
- **情報統合**: 必要な情報をワンストップで提供
- **視覚的フィードバック**: 行動結果の即座な反映
- **戦況把握**: 全体状況と詳細情報のバランス

### ユーザビリティ
- **直感的操作**: クリック中心の分かりやすい操作
- **情報密度**: 画面サイズに応じた情報表示最適化
- **レスポンシブ**: 異なるデバイスでの適切な表示

### ゲーム体験
- **没入感**: スムーズな操作による集中力維持
- **学習曲線**: 初心者にも分かりやすいUI設計
- **上級者対応**: 高速操作とショートカット対応

## 設定とカスタマイズ

### 表示設定
- **アニメーション速度**: 戦闘・移動アニメーションの調整
- **情報表示レベル**: 初心者向け詳細表示 vs 上級者向け簡略表示
- **カメラ制御**: ズームイン・アウト、画面追従機能

### アクセシビリティ
- **色覚対応**: 色だけでない情報伝達
- **文字サイズ**: 拡大表示オプション
- **音声フィードバック**: 重要なイベントの音声通知

## エラーハンドリング
- **不正操作**: 無効な行動の防止とユーザーへの通知
- **ネットワークエラー**: 通信切断時の状態保持
- **状態復旧**: 異常終了からの自動復旧機能

## 依存関係
- [[GameBoard]] - メインゲーム表示エリア
- [[InformationPanel]] - 詳細情報表示
- [[Header]] - ゲーム状況表示
- [[useGameLogic]] - ゲームロジック処理
- [[BattleReportModal]] - 戦闘結果詳細表示

## 関連画面
- [[UnitDeploymentScreen]] - 戦闘前のユニット配置
- [[ResultScreen]] - 戦闘終了後の結果表示
- [[BattlePrepScreen]] - 戦闘準備画面

## タグ
#BattleScreen #MainGame #UI #TacticalGameplay #UserInterface #GameFlow